<div class="page-content">
  <div *ngIf="apiDetail; else spinner" class="main-container">
    <div class="data-detail-header">
      <div class="left-container">
        <ng-container *ngIf="apiDetail">
          <div class="api-name" (click)="toApiList()">บริการข้อมูล</div>
          <div class="api-name">&nbsp; > &nbsp;</div>
          <div class="api-name" (click)="toApiListWithCategory()">
            {{ apiDetail.catName }}
          </div>
          <div class="api-name">&nbsp; > &nbsp;</div>

          <div class="api-name">
            &nbsp;
            {{ apiDetail.apiName }}
          </div>
        </ng-container>
      </div>
      <div class="back-button" (click)="back()">< Back</div>
    </div>
    <div class="request-label header-1">
      {{ apiDetail.apiName }}
    </div>

    <div class="data-button-container">
      <button
        mat-flat-button
        class="request-data-button big-button"
        color="primary"
        (click)="onRequestData()"
      >
        ขอใช้ข้อมูล
      </button>
    </div>
    <div class="data-detail-body">
      <mat-tab-group class="data-tab" dynamicHeight>
        <mat-tab>
          <ng-template mat-tab-label>
            <img class="small-icon" src="assets/icon/file.svg" />
            รายละเอียด
          </ng-template>
          <div class="data-detail-tab">
            <div class="image-container">
              <img
                *ngIf="!apiDetail.picture"
                class="image"
                src="assets/icon/profile-icon.png"
              />
              <img
                *ngIf="apiDetail.picture"
                class="profile-image"
                [src]="apiDetail.tempPicture"
              />
            </div>
            <div class="detail-container">
              <div class="department-container">
                {{ apiDetail.departmentName }}
              </div>
              <div class="topic-container">
                {{ apiDetail.apiName }}
              </div>
              <div class="file-type-container">
                <dpt-file-button
                  (click)="onClickFile(apiDetail.tType)"
                  [formatType]="apiDetail.tType"
                ></dpt-file-button>
                <div class="download" *ngIf="isShowDownload()">
                  <button
                    mat-button
                    class="default-button"
                    color="primary"
                    (click)="onClickFile(apiDetail.tType)"
                  >
                    ดาวน์โหลดไฟล์
                  </button>
                </div>
                <div class="file-size-container" *ngIf="fileSize">
                  ขนาดไฟล์ {{ fileSize }}
                </div>
              </div>

              <div class="view-container">
                <div class="icon-container">
                  <mat-icon>visibility</mat-icon>
                </div>
                {{ apiDetail.countview }} Views
              </div>
              <div class="detail1-container">
                {{ apiDetail.apiDetail }}
              </div>
            </div>
          </div>
        </mat-tab>
        <mat-tab
          *ngIf="
            apiDetail.tType === 'api' ||
            apiDetail.tType === 'wms' ||
            apiDetail.tType === 'wfs' ||
            apiDetail.tType === 'wps'
          "
        >
          <ng-template mat-tab-label>
            <img class="small-icon" src="assets/icon/chip.svg" />
            รายละเอียด Api
          </ng-template>
          <div class="data-detail-api">
            <div class="api-service">API Service</div>
            <div class="api-link">
              <img
                class="copy-icon"
                (click)="copy()"
                src="assets/icon/copy.svg"
              />
              <div *ngIf="apiDetail.tType === 'api'" class="api-link-label">
                {{ apiDetail.apiLink }}
              </div>
            </div>
            <div class="api-param-table">
              <table mat-table [dataSource]="dataSource">
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef>Name</th>
                  <td mat-cell *matCellDef="let row">{{ row.name }}</td>
                </ng-container>
                <ng-container matColumnDef="type">
                  <th mat-header-cell *matHeaderCellDef>Type</th>
                  <td mat-cell *matCellDef="let row">{{ row.type }}</td>
                </ng-container>
                <ng-container matColumnDef="description">
                  <th mat-header-cell *matHeaderCellDef>Type</th>
                  <td mat-cell *matCellDef="let row">{{ row.description }}</td>
                </ng-container>
                <ng-container matColumnDef="default">
                  <th mat-header-cell *matHeaderCellDef>Default</th>
                  <td mat-cell *matCellDef="let row">{{ row.default }}</td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr
                  mat-row
                  *matRowDef="let row; columns: displayedColumns"
                ></tr>
              </table>
            </div>
            <hr />
            <div class="detail1-container">
              <quill-view-html
                [content]="tempDetail"
                theme="snow"
              ></quill-view-html>
            </div>
            <!-- <div class="api-data-label">การเรียกข้อมูล API</div>
            <div class="api-data-container">
              <div class="label">Connection String :</div>
              <div class="value">
                {{ apiDetail.api.connectionString }}
              </div>
              <div class="label">ตัวอย่างการเรียกข้อมูล:</div>
              <div class="value">
                {{ apiDetail.api.dataRequestExample }}
              </div>
              <div class="label">ตัวอย่าง Javascript :</div>
              <div class="value">
                {{ apiDetail.api.javascriptExample }}
              </div>
            </div> -->
          </div>
        </mat-tab>
        <mat-tab *ngIf="apiDetail.tType === 'zip'">
          <ng-template mat-tab-label>
            <img class="small-icon" src="assets/icon/chip.svg" />
            รายละเอียดไฟล์
          </ng-template>
          <div class="data-detail-api">
            <div class="api-service">API Service</div>
            <div class="api-link">
              <img
                class="copy-icon"
                (click)="copy()"
                src="assets/icon/copy.svg"
              />
              <div class="api-link-label">
                {{ apiDetail.apiLink }}
              </div>
            </div>
            <div class="api-param-table">
              <table mat-table [dataSource]="dataSourceZip">
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef>ชื่อไฟล์</th>
                  <td mat-cell *matCellDef="let row">{{ row['name'] }}</td>
                </ng-container>
                <ng-container matColumnDef="size">
                  <th mat-header-cell *matHeaderCellDef>ขนาดไฟล์</th>
                  <td mat-cell *matCellDef="let row">{{ row['size'] }}</td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="displayedZipColumns"></tr>
                <tr
                  mat-row
                  *matRowDef="let row; columns: displayedZipColumns"
                ></tr>
              </table>
            </div>
            <hr />
            <div class="detail1-container">
              <quill-view-html
                [content]="tempDetail"
                theme="snow"
              ></quill-view-html>
            </div>
            <!-- <div class="api-data-label">การเรียกข้อมูล API</div>
            <div class="api-data-container">
              <div class="label">Connection String :</div>
              <div class="value">
                {{ apiDetail.api.connectionString }}
              </div>
              <div class="label">ตัวอย่างการเรียกข้อมูล:</div>
              <div class="value">
                {{ apiDetail.api.dataRequestExample }}
              </div>
              <div class="label">ตัวอย่าง Javascript :</div>
              <div class="value">
                {{ apiDetail.api.javascriptExample }}
              </div>
            </div> -->
          </div>
        </mat-tab>
        <mat-tab *ngIf="(dataSourceHistory.data?.length ?? 0) > 1">
          <ng-template mat-tab-label>
            <img class="small-icon" src="assets/icon/chip.svg" />
            ประวัติไฟล์
          </ng-template>
          <div class="data-management-table default-table">
            <table mat-table [dataSource]="dataSourceHistory" matSort>
              <ng-container matColumnDef="order">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  ลำดับที่
                </th>
                <td mat-cell *matCellDef="let row; let i = index">
                  {{
                    i +
                      1 +
                      (dataSource.paginator?.pageIndex ?? 0) *
                        (dataSource.paginator?.pageSize ?? 0)
                  }}
                </td>
              </ng-container>

              <ng-container matColumnDef="fileName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  ชื่อไฟล์
                </th>
                <td mat-cell *matCellDef="let row">{{ row.fileName }}</td>
              </ng-container>

              <ng-container matColumnDef="timestamp">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  วันที่สร้าง
                </th>
                <td mat-cell *matCellDef="let row">
                  {{ row.timestamp | date: 'dd/MMM/yyyy' }}
                </td>
              </ng-container>

              <ng-container matColumnDef="action">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let row">
                  <div class="data-management-data-container">
                    <mat-icon
                      class="default-icon"
                      (click)="onDownload(row.hid, row.fileName)"
                    >
                      get_app</mat-icon
                    >
                  </div>
                </td>
              </ng-container>

              <tr
                mat-header-row
                *matHeaderRowDef="displayedHistoryColumns"
              ></tr>
              <tr
                mat-row
                *matRowDef="let row; columns: displayedHistoryColumns"
              ></tr>
            </table>
            <mat-paginator
              [length]="200"
              [pageSize]="10"
              [pageSizeOptions]="[10, 50, 100]"
            >
            </mat-paginator>
          </div>
        </mat-tab>
        <mat-tab
          *ngIf="
            (apiDetail.tType === 'wms' ||
              apiDetail.tType === 'wfs' ||
              apiDetail.tType === 'wps') &&
            apiDetail.tokenKey
          "
        >
          <ng-template mat-tab-label>
            <img class="small-icon" src="assets/icon/chip.svg" />
            แผนผัง
          </ng-template>
          <div class="data-detail-api">
            <iframe
              class="iframe-container"
              *ngIf="apiDetail.tokenKey"
              [src]="getLink"
            ></iframe>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
</div>
<ng-template #spinner>
  <div class="spinner">
    <mat-spinner [diameter]="100"></mat-spinner>
  </div>
</ng-template>
